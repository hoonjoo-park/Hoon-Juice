---
title: 'Core Dataì— ëŒ€í•´ ì•Œì•„ë³´ì (Swift)'
date: '2023.03.17'
category: 'Swift'
excerpt: 'iOSì˜ ë¡œì»¬ ì €ì¥ì†Œë¥¼ í™œìš©í•  ìˆ˜ ìˆë„ë¡ ë•ëŠ” FirstParty í”„ë ˆì„ì›Œí¬ì¸ CoreDataì— ëŒ€í•´ ì•Œì•„ë³´ì.'
thumbnail: '/images/core-data.webp'
---

## ì½”ì–´ ë°ì´í„°(Core Data)ë€?

> ì½”ì–´ ë°ì´í„°ëŠ” iOS ë””ë°”ì´ìŠ¤ ë¡œì»¬ ì €ì¥ì†Œì— ë°ì´í„°ë¥¼ ì˜êµ¬ì ìœ¼ë¡œ ì €ì¥í•  ìˆ˜ ìˆê²Œ ë„ì™€ì£¼ëŠ” **í”„ë ˆì„ì›Œí¬**ë‹¤. (DBëŠ” ì•„ë‹˜)

ê·¼ë° ë”± ë´ë„ DBê°™ì€ ì´ë¦„ì„ ê°€ì§„ Core Dataê°€ DBê°€ ì•„ë‹Œ ì´ìœ ê°€ ë­˜ê¹Œ? ğŸ§

![](https://user-images.githubusercontent.com/67448481/225933483-25586c8a-e804-4ba6-93b2-cfbbb7ef99f5.png)

Core DataëŠ” ìš°ë¦¬ì˜ ëª¨ë¸ì´ SQLiteì— CRUDë  ìˆ˜ ìˆë„ë¡ ê´€ë¦¬í•´ì£¼ëŠ” ê²ƒì´ì§€, ê·¸ ìì²´ë¡œì¨ ë°ì´í„°ë² ì´ìŠ¤ì¸ ê²ƒì€ ì•„ë‹ˆê¸° ë•Œë¬¸ì´ë‹¤. ì¦‰, iOSì˜ DBëŠ” SQLiteì´ê³  ì´ë¥¼ í™œìš© ë° ê´€ë¦¬í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” "í”„ë ˆì„ì›Œí¬"ê°€ ë°”ë¡œ CoreDataì¸ ê²ƒì´ë‹¤.

í ... ì¼ë‹¨ í”„ë ˆì„ì›Œí¬ì¸ ê²ƒê¹Œì§€ëŠ” ì•Œê² ëŠ”ë°, ì™œ Core Dataì˜ ì¥ì ê³¼ ë‹¨ì ì—ëŠ” ì–´ë–¤ ê²ƒë“¤ì´ ìˆê¸¸ë˜ ì´ê²ƒì´ í•„ìš”í•œê±¸ê¹Œ?

> í•„ìê°€ ìƒê°í•˜ëŠ” ê°€ì¥ ì£¼ëœ ì¥ì ë“¤ ì¤‘ í•˜ë‚˜ëŠ”, Appleì—ì„œ ê³µì‹ì ìœ¼ë¡œ ì§€ì›í•˜ëŠ” **First Party Library**ì´ê¸° ë•Œë¬¸ì´ë¼ëŠ” ê²ƒì´ë‹¤.

ë°”ë¡œ Core Dataì˜ ì¥ì ê³¼ ë‹¨ì ì— ëŒ€í•´ ê°„ë‹¨íˆ ì•Œì•„ë³´ë„ë¡ í•˜ì.

### ğŸŸ¢ ì¥ì 

1. Core Dataê°€ ì• í”Œì˜ First Partyí”„ë ˆì„ì›Œí¬ë¼ëŠ” ì  (ë§¤ìš° ë†’ì€ í˜¸í™˜ì„±ê³¼ ì•ˆì •ì„± ë³´ì¥)
2. Third-Party ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ì˜ì¡´í•  í•„ìš”ê°€ ì—†ë‹¤.
3. ìºì‹± ë° ë©”ëª¨ë¦¬ ê´€ë¦¬ ê¸°ëŠ¥ ìë™ìœ¼ë¡œ ì§€ì›

### ğŸŸ  ë‹¨ì 

1. ì›ê²© ì €ì¥ì†Œ(DB)ë¡œì¨ ì‚¬ìš©ë  ìˆ˜ ì—†ë‹¤.
2. ëŒ€ìš©ëŸ‰ ë°ì´í„° ë° ë³µì¡í•œ ì¿¼ë¦¬ ì²˜ë¦¬ì—ëŠ” ì œí•œì´ ìˆì„ ìˆ˜ ìˆë‹¤.
3. Object Graph Persistenceì— ëŒ€í•´ ê³ ë ¤í•´ì•¼ í•œë‹¤. (ë’¤ì—ì„œ ì„¤ëª… ì˜ˆì •)

---

## ì½”ì–´ ë°ì´í„°ì˜ ë™ì‘ ë°©ì‹

![](https://user-images.githubusercontent.com/67448481/225933500-e0722e16-4960-45fb-9166-1679910fea7e.png)

> ê°œëµì ì¸ í”Œë¡œìš°ëŠ” ìœ„ì˜ ì‚¬ì§„ê³¼ ê°™ë‹¤

ë§Œì•½ ë‚´ê°€ ì €ì¥í•˜ê³  ì‹¶ì€ ë°ì´í„° ê°ì²´ë¥¼ ìœ„ì˜ ë°•ìŠ¤ ì´ë¯¸ì§€ë¼ê³  ê°€ì •í•´ ë³´ì. ì´ ë•Œ ìš°ë¦¬ëŠ” ì´ ë°ì´í„°ë¥¼ SQLiteì— ì§ì ‘ì ìœ¼ë¡œ ì €ì¥í•˜ê±°ë‚˜ ë¹¼ì˜¤ëŠ” ê²ƒì´ ì•„ë‹ˆë‹¤. `Managed Object Context`ê°€ ìœ„ì˜ ë°•ìŠ¤ë¥¼ ë°›ì•„ ì €ì¥ì†Œì— ë°ì´í„°ë¥¼ ì €ì¥í•´ ì£¼ê³  êº¼ë‚´ì™€ ì£¼ëŠ” ëŒ€ë¦¬ì¸ ì—­í• ì„ í•´ì£¼ëŠ” ê²ƒì´ë‹¤.

ì´ëŸ° ê°œê´„ì ì¸ ì„¤ëª…ì—ì„œ ê·¸ì¹˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ìœ„ì˜ ì‚¬ì§„ì—ì„œ ë³´ì´ëŠ” ì„¸ ì„¹ì…˜ì˜ ê°œë…ì— ëŒ€í•´ ì¡°ê¸ˆ ë” ìì„¸íˆ ì„¤ëª…í•´ ë³´ë„ë¡ í•˜ê² ë‹¤.

### NSManagedObject

![](https://user-images.githubusercontent.com/67448481/225933510-9308e186-d6ae-4727-8b66-3c3b4994bdc6.png)

> CoreDataì˜ í•µì‹¬ í´ë˜ìŠ¤ë¡œ, ë°ì´í„° ëª¨ë¸ì— ì •ì˜ëœ ì—”í‹°í‹°ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ê°ì²´ë‹¤.  
> ì¡°ê¸ˆ ë” ì‰½ê²Œ ì–˜ê¸°í•˜ìë©´, DBì— ë‹´ê¸´ ë°ì´í„°ì˜ í˜•íƒœë¼ê³  ë³¼ ìˆ˜ë„ ìˆì„ ê²ƒì´ë‹¤.

ìš°ë¦¬ëŠ” ì›í•˜ëŠ” ë°ì´í„° ëª¨ë¸ì„ ì´ `NSManagedObject`ë¡œ ì„œë¸Œí´ë˜ì‹± í•´ì„œ, `Managed Object Context`ê°€ ì´ë¥¼ ì§ë ¬í™”(Serialize) ë° ì—­ì§ë ¬í™”(Deserialize) í•˜ì—¬ ë¡œì»¬ ì €ì¥ì†Œì— ì €ì¥ ê°€ëŠ¥í•˜ë„ë¡ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.

ì¦‰, ìš°ë¦¬ê°€ ë§Œë“  ë°ì´í„° ëª¨ë¸ì´ `NSManagedObject` í´ë˜ìŠ¤ì— ì„œë¸Œí´ë˜ì‹± ë˜ë©´ì„œ -> `Managed Object Context`ì— ì˜í•´ í•¸ë“¤ë§ ë  ìˆ˜ ìˆëŠ” í˜•íƒœê°€ ëœë‹¤ëŠ” ê²ƒì´ë‹¤.

### Managed Object Context

> ì´ë¦„ì—ì„œë„ ìœ ì¶”í•  ìˆ˜ ìˆë“¯ì´, ì´ëŠ” ë°ì´í„° ê°ì²´ì˜ ë§¤ë‹ˆì§• ë° í•¸ë“¤ë§ì„ ë‹´ë‹¹í•˜ëŠ” ê³„ì¸µì´ë‹¤.

ìœ„ì—ì„œ ì„¤ëª…í•œ `Managed Object ` ì¸ìŠ¤í„´ìŠ¤ëŠ” ì´ ì»¨í…ìŠ¤íŠ¸ì—ì„œ ìƒì„±ëœë‹¤. ê·¸ë¦¬ê³ , í•´ë‹¹ ê°ì²´ë¥¼ ìˆ˜ì • ë° ì‚­ì œí•˜ê³  í•´ë‹¹ ë³€ê²½ì‚¬í•­ì„ ë¡œì»¬ ì €ì¥ì†Œì— ë°˜ì˜í•˜ëŠ” ì—­í• ì„ í•œë‹¤.

![](https://user-images.githubusercontent.com/67448481/225933513-279028d3-d8bf-4b47-a070-ebaf946cebd7.png)

ê·¸ë¦¬ê³  ìœ„ì˜ ì‚¬ì§„ê³¼ ê°™ì´ ë¡œì»¬ ì €ì¥ì†Œë¡œë¶€í„° ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™€ ì—­ì§ë ¬í™”(Deserialize) í•˜ì—¬ ìš°ë¦¬ê°€ ì‚¬ìš© ê°€ëŠ¥í•œ ë°ì´í„° í˜•íƒœë¡œ ë³€í™˜í•´ ì£¼ê¸°ë„ í•œë‹¤. ë°˜ëŒ€ë¡œ, ìš°ë¦¬ì˜ ë°ì´í„° ê°ì²´ë¥¼ ì§ë ¬í™”(Serialize) í•˜ì—¬ ë°ì´í„° ë² ì´ìŠ¤ì— ì´ë¥¼ í˜•íƒœì— ë§ê²Œ ì €ì¥í•´ ì£¼ê¸°ë„ í•œë‹¤.

### Persistent Container

> ìš°ë¦¬ì˜ DB ë˜ëŠ” Core Data Storeì˜ ë³¸ì²´ë¼ê³  ìƒê°í•˜ë©´ ëœë‹¤.

ì¤‘ìš”í•œ ì ì€, ë°ì´í„° ê°ì²´ê°€ Persistent Containerì™€ ì§ì ‘ì ìœ¼ë¡œ ìƒí˜¸ì‘ìš©ì„ í•˜ì§€ëŠ” ì•ŠëŠ”ë‹¤ëŠ” ê²ƒì´ë‹¤. ìœ„ì—ì„œë„ ì„¤ëª…í–ˆë“¯, `Managed Object Context`ë¼ëŠ” ê³„ì¸µì—ì„œ ì´ë¥¼ ëŒ€ì‹ í•´ì„œ ìˆ˜í–‰í•˜ê¸° ë•Œë¬¸ì´ë‹¤.

### í•µì‹¬ í”Œë¡œìš°

1. Core Data ëª¨ë¸ì— Entityì™€ Attributes(ì†ì„±)ë¥¼ ì •ì˜.
2. ì •ì˜í•œ ë°ì´í„° ëª¨ë¸ì„ ê¸°ë°˜ìœ¼ë¡œ í´ë˜ìŠ¤ë¥¼ ìƒì„±
3. Persistent Containerì— ëŒ€í•œ ì°¸ì¡°ë¥¼ ì–»ëŠ”ë‹¤.
4. ê·¸ë¦¬ê³  í•´ë‹¹ ì°¸ì¡°ë¥¼ í†µí•´ Managed Object Contextë¥¼ ë°›ëŠ”ë‹¤.
5. ì´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ CRUDë¥¼ ìˆ˜í–‰

---

## í™œìš© ë°©ë²•

> ì´ì œ ê¸°ë³¸ì ì¸ CoreDataì˜ ê°œë…ì— ëŒ€í•´ì„œ ì•Œì•„ë´¤ìœ¼ë‹ˆ,  
> ê¸°ë³¸ì ì¸ CoreDataì˜ í™œìš© ë°©ë²•ì— ëŒ€í•´ì„œ ì•Œì•„ë³´ë„ë¡ í•˜ì.

#### Persistent Container ì°¸ì¡°

> ViewControllerì—ì„œ ì•„ë˜ì™€ ê°™ì´ Persistent Containerì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.

```swift
var context = (UIApplication.shared.delegate as! AppDelegate).persistentContainer.viewContext
```

### CRUD

> ê·¸ë¦¬ê³  ê¸°ë³¸ì ì¸ CRUD í™œìš© ë°©ë²•ì€ ì•„ë˜ì™€ ê°™ë‹¤.

#### Create

```swift
var context = (UIApplication.shared.delegate as! AppDelegate).persistentContainer.viewContext

let newData = YourModel(context: context)
// ë°ì´í„° ê°ì²´ì— ë³€í™”ë¥¼ ì¤€ë‹¤.
newData.something = "something"

do {
	// ê·¸ë¦¬ê³  í•´ë‹¹ ë³€ê²½ì‚¬í•­ì„ ì €ì¥í•œë‹¤.
	try self.context.save()
}
catch {
	// write error codes here
}
```

#### Read

```swift
var request = YourModel.fetchRequest() as NSFetchRequest<YourModel>

do {
	try self.context.fetch(request)
}
catch {
	// write error codes here
}
```

#### Update

```swift
// DataToUpdateë¼ëŠ” íŠ¹ì • ë°ì´í„°ë¥¼ ìœ„ì—ì„œ ì„ ì–¸í•´ì¤¬ë‹¤ê³  ê°€ì •í•œë‹¤.
DataToUpdate.someProperty = "value to change"

do {
	try self.context.save()
}
catch {
	// write error codes here
}
```

#### Delete

> Updateì™€ ê±°ì˜ ìœ ì‚¬í•˜ë‹¤.

```swift
// DataToRemoveë¼ëŠ” íŠ¹ì • ë°ì´í„°ë¥¼ ìœ„ì—ì„œ ì„ ì–¸í•´ì¤¬ë‹¤ê³  ê°€ì •í•œë‹¤.
context.delete(DataToRemove)

do {
	try self.context.save()
}
catch {
	// write error codes here
}
```

---

## í•„í„° & ì •ë ¬ ê¸°ëŠ¥

> ë§ˆì§€ë§‰ìœ¼ë¡œ, ë°ì´í„°ë¥¼ ê·¸ëƒ¥ í†µì§¸ë¡œ ë¶ˆëŸ¬ì™€ ê·¸ëŒ€ë¡œ í™œìš©í•˜ëŠ” ë°©ë²•ì—ì„œ ë” ë‚˜ì•„ê°€,  
> ë°ì´í„°ë¥¼ í•„í„° ë° ì •ë ¬í•˜ì—¬ fetchí•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ì„œ ì„¤ëª…í•´ ë³´ë„ë¡ í•˜ê² ë‹¤.

### í•„í„°(filter)

> ë¨¼ì €, í•„í„°ë§ ëœ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë°©ë²•ì´ë‹¤.

```swift
var request = YourModel.fetchRequest() as NSFetchRequest<YourModel>

// 1. ì•„ë˜ì™€ ê°™ì´ í•˜ë©´ ë™ì  ë°ì´í„°ì— ëŒ€í•œ í•„í„°ë§ì„ í•  ìˆ˜ ìˆë‹¤. (variablesì— ì›í•˜ëŠ” ë³€ìˆ˜ ëŒ€ì…)
let predicate = NSPredicate(format: "someProperty CONTAINS %@", variables)
// 2. ì•„ë‹ˆë©´ ê°’ì„ ê·¸ëŒ€ë¡œ ë„£ì–´ì¤„ ìˆ˜ë„ ìˆë‹¤.
let predicate = NSPredicate(format: "someProperty CONTAINS hoonjoo")
request.predicate = predicate

do {
	try context.fetch(request)
}
catch {
	// ì—ëŸ¬ í•¸ë“¤ë§ ì½”ë“œ
}
```

ì°¸ê³ ë¡œ, NSPredicateì— ëŒ€í•œ ë¬¸ë²•ì€ ì•„ë˜ ë§í¬ë¥¼ í™•ì¸í•˜ë©´ ì‰½ê²Œ ê°ì„ ì¡ì„ ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.
[NSPredicate Cheatsheet]('https://academy.realm.io/posts/nspredicate-cheatsheet/')

### ì •ë ¬

> ì •ë ¬ì€ í•„í„°ë§ì— ë¹„í•´ êµ‰ì¥íˆ ê°„ë‹¨í•˜ë‹¤. (ì¡°ê¸ˆ ë” ì§ê´€ì )

```swift
// ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ì½”ë“œëŠ” ìœ„ì™€ ë™ì¼í•˜ë‹¤ê³  ê°€ì •...

let sort = NSSortDescriptor(key: 'someProperty', ascending: true) // ì˜¤ë¦„ì°¨ìˆœ

request.sortDescriptors = [sort]
```

---
